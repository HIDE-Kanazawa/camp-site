{% if page.content contains '<h2' %}
<nav class="table-of-contents">
  <h2>目次</h2>
  <ul>
    {% assign headers = page.content | split: '<h2' %}
    {% for header in headers offset:1 %}
      {% assign header_parts = header | split: '</h2>' %}
      {% assign header_content = header_parts[0] | split: '>' | last %}
      {% assign header_id = header_content | slugify %}
      <li><a href="#{{ header_id }}">{{ header_content | strip_html }}</a></li>
    {% endfor %}
  </ul>
</nav>

<script>
// 目次のアンカーリンク用にh2にIDを自動付与
document.addEventListener('DOMContentLoaded', function() {
  var headers = document.querySelectorAll('.post-content h2');
  headers.forEach(function(header) {
    var id = header.textContent.toLowerCase()
      .replace(/\s+/g, '-')
      .replace(/[^\w\-\u3040-\u309f\u30a0-\u30ff\u4e00-\u9faf]/g, '');
    header.id = id;
  });
});
</script>
{% endif %}
